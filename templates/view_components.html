{% extends "base.html" %}
{% block title %}Информация о компонентах{% endblock %}
{% load user_filters %}

{% block content %}
<h1 class="text-center">Информация о компонентах</h1>

<hr>


<nav class="navbar">
  <div class="container">
    <button type="button" class="btn btn-outline-primary nav-link zoom-menu mb-2" data-bs-toggle="modal" data-bs-target="#new_component">Новый компонент</button>
    <button type="button" class="btn btn-outline-primary nav-link zoom-menu mb-2" data-bs-toggle="modal" data-bs-target="#update_amount">Увеличить количество</button>
    <button type="button" class="btn btn-outline-primary nav-link zoom-menu mb-2" data-bs-toggle="modal" data-bs-target="#update_price">Изменить цену</button>
  </div>
</nav>

<div class='container'>
  {% include 'includes/messages.html' %}
</div>

<hr>

{% include 'includes/component_filter.html' %}

<hr>

<div class="modal fade" id="new_component" data-bs-backdrop="static" data-bs-keyboard="false"  aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Добавить новый компонент</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action='{% url "new_component" %}' method='POST'>
          {% csrf_token %}
          <div class="modal-body">
            {% if form.subject.errors %}
                <ol>
                {% for error in form.subject.errors %}
                    <li><strong>{{ error|escape }}</strong></li>
                {% endfor %}
                </ol>
            {% endif %}
            {{ new_component_form.type_component.errors }}
            {{ new_component_form.type_component.label_tag }}
            {{ new_component_form.type_component}}
            {{ new_component_form.marking.label_tag }}
            {{ new_component_form.marking }}
            {{ new_component_form.note.label_tag }}
            {{ new_component_form.note }}
            {{ new_component_form.amount_trk.label_tag }}
            {{ new_component_form.amount_trk }}
            {{ new_component_form.amount_eis.label_tag }}
            {{ new_component_form.amount_eis }}
            {{ new_component_form.amount_vts.label_tag }}
            {{ new_component_form.amount_vts }}
            {{ new_component_form.price.label_tag }}
            {{ new_component_form.price }}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            <button type="submit" class="btn btn-primary">Добавить</button>
          </div>
        </form>
      </div>
    </div>
</div>
<!-- Модальное окно добавления нового типа блока -->
<div class="modal fade" id="update_amount" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Увеличить количество</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action='{% url "update_amount" %}' method='POST'>
          {% csrf_token %}
          <div class="modal-body">
            {{ update_amount_form.component.label_tag }}
            {{ update_amount_form.component }}
            {{ update_amount_form.amount.label_tag }}
            {{ update_amount_form.amount }}
            {{ update_amount_form.company.label_tag}}
            {{ update_amount_form.company }}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            <button type="submit" class="btn btn-primary">Добавить</button>
          </div>
        </form>
      </div>
    </div>
</div>
<!-- Модальное окно добавления региона -->
<div class="modal fade" id="update_price" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Изменение цены компонента</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action='{% url "update_price" %}' method='POST'>
          {% csrf_token %}
          <div class="modal-body">
            {% for field in update_price_form %}
              {{ field.label }}
              {{ field }}
              <br>
            {% endfor %}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
            <button type="submit" class="btn btn-primary">Изменить</button>
          </div>
        </form>
      </div>
    </div>
</div>


<div class='ms-3 me-3'>
    <table class="table table-sm table-bordered table-hover">
        <thead>
            <tr>
                <th scope="col" style="width: 1%"></th>
                <th scope="col">Наименование компонента <br>Всего наименований: кол-во</th>
                <th>Ссылки на поиск</th>
                <th scope="col" style="width: 5%">Количество ЭИС</th>
                <th scope="col" style="width: 5%">Количество ТРК</th>
                <th scope="col" style="width: 5%">Количество ВТС</th>
                <th scope="col" style="width: 5%">Общее количество</th>
                <th scope="col" style="width: 10%">Списано за прошедшие 30 дней</th>
                <th scope="col" style="width: 10%">Цена за единицу</th>
            </tr>
        </thead>
        <tbody>
            {% for record, cnt in result %}
            <tr>
                <td><a href="{% url 'edit_component' record.pk %}">ред.</a></td>
                <td>{{ record.type_component }}
                    {{ record.marking }}
                    {{ record.note|default_if_none:"" }}  
                </td>
                <td>
                    <a href="https://www.chipdip.ru/search?searchtext={{ record.marking }}">ChipDip</a>&nbsp
                    <a href="https://www.elitan.ru/price/index.php?find={{ record.marking }}&delay=-1&mfg=all&seenform=y">Elitan</a>&nbsp
                    <a href="https://www.platan.ru/cgi-bin/qwery_i.pl?code={{ record.marking }}">Platan</a>  
                </td>
                <td>{{ record.amount_eis }}</td>
                <td>{{ record.amount_trk }}</td>
                <td>{{ record.amount_vts }}</td>
                <td>{{ record.summ }}</td>
                <td>{{ cnt }}</td>
                <td>{{ record.price }} р/шт</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
